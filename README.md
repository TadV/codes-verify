## Подтверждение данных, с помощью сервиса по отправке пользователям секретных кодов

#### Описание
С помощью сервиса внешние системы могут разными способами отправить пользователям секретные коды для подтверждения введенных данных. Пользователь может получить коды следующими образами:
* По СМС
* По Email
* При автоматическом звонке ( последние 4 цифры входящего номера )
* По запросу через Колл-Центр ( список связанных активных кодов доступен в административной панели )
* Через мессенджеры разрешающие отправку сообщений по номеру телефона
* Посредством Push-уведомления в мобильном приложении

В зависимости от дополнительных параметров коды могут быть 4х и 6и-значной длины, состоять из цифр и уникальных латинских букв ( регистр игнорируется ) - по умолчанию: **4 цифры.**

Код действителен ограниченное время - 5 минут с момента генерации.


#### Бизнес процесс:

1. На стороне клиента генерируется форма ( или просто во время запроса формируется пакет данных ) с необходимыми параметрами.

    Параметры json объекта:
    * `source` - обозначение источника *( по умолчанию host источника )*
    * `form` - форма в источнике, уточняет где вводится код *( по умолчанию path источника )*
    * `guid` - уникальный идентификатор для каждого запроса генерации, обязательный параметр,
    * `type` - тип подтверждения ( call, sms, email, telegram, push), *( по умолчанию sms )*
    * `verify` - значение подтверждаемого значения ( телефон или email ), **обязательный параметр**
    * `options` - необязательные добавочные параметры генерации кода ( длина кода / сложность / время хранения )
    
    ###### Примеры
    ```
    {"source" : "im", "form" : "reg", "guid" : "ersdf34oq6", "type" : "call", "verify" : "79194698349"}
    ```
    ```
    {"source" : "somesite.ru", "form" : "/some/path/", "guid" : "kn1m7i8op3", "type":"sms", "verify" : "89194698349"}
    ```
    ```
    {"source" : "1c", "form" : "check", "guid" : "op2k4ms4n1", "type":"email", "verify" : "tad.work@ya.ru"}
    ```
    ```
    {"source" : "apimlm", "form" : "reg", "guid" : "tl13msq9yk", "type":"sms", "verify" : "375291234567"}
    ```
    
2. [Сервис][service] получает входящий запрос на формирование кода подтверждения исходя из параметров запроса.
    
	`/api/v1/verify/code/get` - path для POST запроса генерации и инициации отправки кода клиенту
	
	В ответ возвращает сообщения двух возможных типов: 
	* Успешная отправка кода пользователю
	
    ###### Примеры	
	```
	{"status" : 1, "type" : "success", "message" : "SMS с кодом подтверждения отправлено"}
    ```
	```
	{"status" : 1, "type" : "success", "message" : "Звонок совершён"}
    ```
    
    * Ошибка во время отправки
    
    ###### Примеры    
	```
	{"status" : 0, "type" : "error", "error" : "101", "message" : "Не смогли дозвониться"}
    ```
	```
	{"status" : 0, "type" : "error", "error" : "103", "message" : "Недопустимый номер телефона"}
    ```
    
    Сохраняет у себя в базе связку __source, form, guid__ с выданым кодом, ставит отметку до какого времени будет активным код. 

3. Клиент вводит код в форму подтверждения. Формируется запрос на проверку кода<br/>
    ( должны использоваться теже значения параметров source, form, guid, verify что и при генерации )

    Параметры json объекта:
    * `source` - обозначение источника *( по умолчанию host источника )*
    * `form` - форма в источнике, уточняет где вводится код  *( по умолчанию path источника )*
    * `guid` - уникальный идентификатор использовавшийся при запросе для генерации, **обязательный параметр**.
    * `verify` - значение подтверждаемого значения ( телефон или email ), **обязательный параметр**
    * `code` - код введённый клиентом , **обязательный параметр**.
    
    ###### Примеры
    ```
    {"source" : "im", "form" : "reg", "guid" : "ersdf34oq6", "verify" : "89194698349", "code" : "7864"}
    ```
    ```
    {"source" : "1c", "form" : "check", "guid" : "op2k4ms4n1", "verify" : "tad.work@ya.ru", "code" : "0880"}
    ```
    

4. [Сервис][service] получает запрос c введенным пользователем кодом.
    
    `/api/v1/verify/code/check` - path для POST запроса проверки связки кода и параметров

    *Технический код подтверждения - __0880__ ( никогда не высылается клиенту )*
    
	В ответ возвращает сообщения двух возможных типов: 
	* Успешное подтверждение
	
    ###### Примеры	
	```
	{"status" : 1, "type" : "success", "message" : "Код подтверждён"}
    ```
    
    * Ошибка во время сверки
    
    ###### Примеры    
	```
	{"status" : 0, "type" : "error", "error" : "201", "message" : "Неправильный код"}
    ```
	```
	{"status" : 0, "type" : "error", "error" : "202", "message" : "Не соответствие данных"} 
    ```
    *если любой из параметров будет отличаться от использованых вовремя генерации то код __не будет подтверждён__* 
	```
	{"status" : 0, "type" : "error", "error" : "203", "message" : "Срок действия кода истёк"}
    ```
     
    
[service]:https://auth.tentorium.ru